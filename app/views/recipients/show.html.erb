<h1><%= @recipient.name %></h1>

<%= render "recipients/show_traits", recipient: @recipient%>
<br>
<%= link_to "Edit", edit_recipient_path(@recipient) %>
<%= link_to "Delete", recipient_path(@recipient), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" } %>

<% if @recipient.birthday.present? && !@recipient.has_birthday_event? %>
  <br><br>
  <div>
    <h3>Birthday Event</h3>
    <p>Create a birthday event for <%= @recipient.name %></p>
    <%= link_to "Create Birthday Event", create_birthday_event_recipient_path(@recipient) %>
  </div>
<% end %>

<br>
<br>
<!--<h3>Gift List</h3>-->
<!--<div style="display: flex; gap: 20px;">-->
  <%# Gift.statuses.keys.each do |status| %>
<!--    <div style="border: 1px solid black; padding: 10px; flex: 1;">-->

<!--      <h3><%#= status %></h3>-->
<!--      <ul>-->
        <%# if @recipient_gift_lists[status] %>
          <%# @recipient_gift_lists[status].each do |gift| %>
<!--            <li>-->
              <%#= link_to gift.name, gift_list_gift_path(gift.gift_list, gift) %>
<!--              (<%#= number_to_currency(gift.price) %>)-->
<!--            </li>-->
          <%# end %>
        <%# end %>
<!--      </ul>-->

<!--    </div>-->
  <%# end %>
<!--</div>-->
<div class="d-flex gap-2">

  <% if @suggestions_exist %>
  <%= button_to "Generate new gift ideas",
                generate_gift_recipient_path(@recipient),
                method: :post,
                params: { refresh: true },
                data: { turbo: false, disable_with: "Thinking of new gift ideas..." }  %>
  <% else %>

    <%= button_to "Ask Giftwise AI Assistant for Gift Ideas",
                  generate_gift_recipient_path(@recipient),
                  method: :post,
                  data: { turbo: false, disable_with: "thinking..." } %>
  <%end %>
</div>

<% if @suggestions %>
  <div class="ai-results">
    <h3> Gift Ideas Based on user profile  </h3>
    <%#= markdown(@suggestions) %>

    <% if @suggestions.is_a?(Hash) %>
      <div class="gift-grid">
        <% @suggestions.each do |gift_name, description| %>
          <h4>
            <%=gift_name %>
          </h4>

          <p>
            <%=description %>
          </p>
        <% end %>

      </div>
    <% end %>
  </div>
<% end %>
<br>
<br>

<!--AI assisted in the styling-->
<h3>Add Event Giftlists for this recipient</h3>
<!--lets partial build a form, passing in local variables -->
<%#= render partial: "gift_lists/form", locals: { gift_list: GiftList.new, recipient: @recipient, events: @recipient.events } %>
<!--it should check for available events-->

<% if @available_events.any? %>
  <%= form_with url: add_event_recipient_path(@recipient), method: :post, local: true do |f| %>
    <%= f.label :event_id, "Choose an existing event" %>
    <%= f.collection_select :event_id,
                            @available_events,
                            :id, :name,
                            include_blank: "Select an event" %>
    <%= f.submit "Create an Event Giftlist for this recipient" %>
  <% end %>
<% else %>
  <p>All of your events are already assigned to this recipient for giftlists.</p>
<% end %>
<br>
<%= link_to "Create an event giftlist for this recipient",
            new_event_path(recipient_id: @recipient.id),
            class: "pretty-link" %>
<div>
<br>

  <% @recipient.gift_lists.each do |list| %>
  <%= render partial: "gift_lists/gift_statuses",
             locals: {list: list}
  %>
<% end %>

</div>

<%= link_to "Back to Recipients", recipients_path %>
<%= link_to "Back to Home", homepage_path %>
